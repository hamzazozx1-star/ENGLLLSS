<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة الأسطورة | ADMIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --sidebar: #0a192f; --bg: #020c1b; --gold: #c5a059; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Cairo'; }
        body { background: var(--bg); color: white; display: flex; }
        .sidebar { width: 280px; height: 100vh; background: var(--sidebar); padding: 30px; border-left: 1px solid var(--gold); }
        .nav-link { display: block; padding: 15px; color: white; text-decoration: none; margin-bottom: 10px; border-radius: 10px; cursor: pointer; }
        .nav-link:hover, .active { background: var(--gold); color: black; }
        .main { flex: 1; padding: 40px; }
        table { width: 100%; border-collapse: collapse; background: #112240; border-radius: 15px; margin-top: 20px; }
        th, td { padding: 15px; text-align: right; border-bottom: 1px solid #1d2d44; }
        .btn { padding: 5px 15px; border-radius: 5px; cursor: pointer; border:none; }
        .btn-act { background: #27ae60; color: white; }
        .btn-del { background: #e63946; color: white; }
        .section { display: none; }
        .active-sec { display: block; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 style="color:var(--gold);">الأسطورة ADMIN</h2>
        <div class="nav-link active" onclick="showSec('users-sec', this)">إدارة الطلاب</div>
    </div>

    <div class="main">
        <div id="users-sec" class="section active-sec">
            <h1>قاعدة بيانات الطلاب</h1>
            <table id="u-table">
                <thead><tr><th>الاسم</th><th>البريد</th><th>الحالة</th><th>الإجراء</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAwet7_yQsLA81udDcgXNPYo5uWz0iepaY",
            authDomain: "engl-8c2c0.firebaseapp.com",
            databaseURL: "https://engl-8c2c0-default-rtdb.firebaseio.com",
            projectId: "engl-8c2c0",
            storageBucket: "engl-8c2c0.firebasestorage.app",
            messagingSenderId: "677642381642",
            appId: "1:677642381642:web:0c58e7b3f86a6d81c4f9b3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function loadData() {
            db.ref('users').on('value', (snap) => {
                const users = snap.val();
                const tbody = document.querySelector('#u-table tbody');
                tbody.innerHTML = '';
                for (let key in users) {
                    let u = users[key];
                    let actionBtn = u.status === 'pending' 
                        ? `<button class="btn btn-act" onclick="updateStatus('${key}', 'accepted')">تفعيل</button>`
                        : `<button class="btn btn-del" onclick="deleteUser('${key}')">حذف</button>`;
                    
                    tbody.innerHTML += `<tr>
                        <td>${u.name}</td>
                        <td>${u.email}</td>
                        <td style="color:${u.status==='pending'?'orange':'lightgreen'}">${u.status}</td>
                        <td>${actionBtn}</td>
                    </tr>`;
                }
            });
        }

        function updateStatus(key, status) {
            db.ref('users/' + key).update({ status: status });
        }

        function deleteUser(key) {
            if(confirm('هل تريد الحذف؟')) db.ref('users/' + key).remove();
        }

        window.onload = loadData;
    </script>
</body>
</html>