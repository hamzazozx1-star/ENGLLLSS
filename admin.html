<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© | ADMIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --sidebar: #0a192f; --bg: #020c1b; --gold: #c5a059; --accent: #112240; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Cairo'; }
        body { background: var(--bg); color: white; display: flex; min-height: 100vh; }
        
        .sidebar { width: 280px; background: var(--sidebar); padding: 30px 20px; border-left: 1px solid var(--gold); position: fixed; height: 100%; overflow-y: auto; }
        .nav-link { display: flex; justify-content: space-between; align-items: center; padding: 15px; color: #8892b0; text-decoration: none; margin-bottom: 10px; border-radius: 10px; cursor: pointer; transition: 0.3s; }
        .nav-link:hover, .active-nav { background: rgba(197, 160, 89, 0.1); color: var(--gold); border: 1px solid var(--gold); }
        .badge { background: #e74c3c; color: white; padding: 2px 8px; border-radius: 50%; font-size: 0.8rem; display: none; }
        
        .main { flex: 1; padding: 40px; margin-right: 280px; }
        .section { display: none; animation: fadeIn 0.5s; }
        .active-sec { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .data-card { background: var(--accent); padding: 20px; border-radius: 15px; border: 1px solid #233554; }
        .data-card h3 { color: var(--gold); margin-bottom: 10px; }
        
        input, select, textarea { width: 100%; padding: 10px; margin: 10px 0; background: #0a192f; border: 1px solid #233554; color: white; border-radius: 5px; outline: none; }
        .btn { padding: 10px 20px; border-radius: 5px; cursor: pointer; border:none; font-weight: bold; margin-top: 10px; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-red { background: #e74c3c; color: white; }
        .btn-green { background: #2ecc71; color: white; }

        table { width: 100%; border-collapse: collapse; background: var(--accent); border-radius: 10px; overflow: hidden; margin-top: 15px; }
        th, td { padding: 15px; text-align: right; border-bottom: 1px solid #233554; }
        th { background: #0a192f; color: var(--gold); }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 style="color:var(--gold); text-align:center; margin-bottom:40px;">Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© ADMIN</h2>
        
        <div class="nav-link active-nav" onclick="showSec('activation-sec', this)">
            <span><i class="fas fa-user-check"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„</span>
            <span class="badge" id="b-act">0</span>
        </div>
        <div class="nav-link" onclick="showSec('students-sec', this)">
            <span><i class="fas fa-users"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</span>
        </div>
        <div class="nav-link" onclick="showSec('add-content-sec', this)">
            <span><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰</span>
        </div>
        <div class="nav-link" onclick="showSec('manage-content-sec', this)">
            <span><i class="fas fa-layer-group"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</span>
        </div>
        <div class="nav-link" onclick="showSec('notify-sec', this)">
            <span><i class="fas fa-bell"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
        </div>
        <div class="nav-link" onclick="showSec('support-sec', this)">
            <span><i class="fas fa-headset"></i> Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</span>
            <span class="badge" id="b-sup">0</span>
        </div>
    </div>

    <div class="main">
        
        <div id="activation-sec" class="section active-sec">
            <h1>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h1>
            <div id="pending-list" class="card-grid"></div>
        </div>

        <div id="students-sec" class="section">
            <h1>Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
            <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…..." onkeyup="filterStudents(this.value)">
            <div id="students-list" class="card-grid"></div>
        </div>

        <div id="add-content-sec" class="section">
            <h1>Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h1>
            <div class="data-card" style="max-width: 600px;">
                <select id="c-type" onchange="toggleFields()">
                    <option value="lecture">Ù…Ø­Ø§Ø¶Ø±Ø©</option>
                    <option value="file">Ù…Ù„Ù / Ù…Ù„Ø®Øµ</option>
                </select>
                <input type="text" id="c-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰">
                <input type="text" id="c-link" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Embed) Ø£Ùˆ Ø§Ù„Ù…Ù„Ù">
                <input type="text" id="c-img" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø© (Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª)">
                <input type="text" id="c-file" placeholder="Ø±Ø§Ø¨Ø· Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙ‚Ø© (PDF) Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
                <button class="btn btn-gold" onclick="addContent()">Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
            </div>
        </div>

        <div id="manage-content-sec" class="section">
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</h1>
            <div id="content-list" class="card-grid"></div>
        </div>

        <div id="notify-sec" class="section">
            <h1>Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h1>
            <div class="data-card" style="max-width: 600px;">
                <select id="n-target">
                    <option value="all">ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                    <option value="specific">Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¯Ø¯ (Ø¨Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„)</option>
                </select>
                <input type="text" id="n-email" placeholder="Ø§ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨" style="display:none;">
                <input type="text" id="n-msg" placeholder="Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±">
                <button class="btn btn-gold" onclick="sendNotify()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>

        <div id="support-sec" class="section">
            <h1>ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h1>
            <div id="tickets-list" style="display:flex; flex-direction:column; gap:15px;"></div>
        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAwet7_yQsLA81udDcgXNPYo5uWz0iepaY",
            authDomain: "engl-8c2c0.firebaseapp.com",
            databaseURL: "https://engl-8c2c0-default-rtdb.firebaseio.com",
            projectId: "engl-8c2c0",
            storageBucket: "engl-8c2c0.firebasestorage.app",
            messagingSenderId: "677642381642",
            appId: "1:677642381642:web:0c58e7b3f86a6d81c4f9b3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- Navigation ---
        function showSec(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active-sec'));
            document.getElementById(id).classList.add('active-sec');
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active-nav'));
            el.classList.add('active-nav');
        }

        // --- 1. Activation & 2. Students ---
        let allStudents = [];
        db.ref('users').on('value', (snap) => {
            const users = snap.val();
            const pendingDiv = document.getElementById('pending-list');
            const studentsDiv = document.getElementById('students-list');
            
            pendingDiv.innerHTML = '';
            studentsDiv.innerHTML = '';
            allStudents = [];
            let pendingCount = 0;

            for(let key in users) {
                let u = users[key];
                u.key = key;
                
                if(u.status === 'pending') {
                    pendingCount++;
                    pendingDiv.innerHTML += `
                        <div class="data-card">
                            <h3>${u.name}</h3>
                            <p>${u.grade === '1' ? '1 Ø«' : u.grade === '2' ? '2 Ø«' : '3 Ø«'}</p>
                            <p>${u.email}</p>
                            <p>${u.phone}</p>
                            <div style="margin-top:10px;">
                                <button class="btn btn-green" onclick="setUserStatus('${key}', 'accepted')">Ù‚Ø¨ÙˆÙ„</button>
                                <button class="btn btn-red" onclick="deleteUser('${key}')">Ø±ÙØ¶</button>
                            </div>
                        </div>
                    `;
                } else {
                    allStudents.push(u);
                    renderStudentCard(u, studentsDiv);
                }
            }
            updateBadge('b-act', pendingCount);
        });

        function renderStudentCard(u, container) {
            container.innerHTML += `
                <div class="data-card">
                    <h3 style="display:flex; justify-content:space-between;">
                        ${u.name} 
                        <span style="font-size:0.8rem; background:var(--gold); color:black; padding:2px 8px; border-radius:10px;">${u.grade} Ø«</span>
                    </h3>
                    <p>ğŸ“§ ${u.email}</p>
                    <p>ğŸ“ ${u.phone}</p>
                    <p>ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ ${u.parent_phone}</p>
                    <p>ğŸ“… Ø§Ù†Ø¶Ù…: ${u.joinDate || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'}</p>
                    <button class="btn btn-red" onclick="setUserStatus('${u.key}', 'blocked')" style="font-size:0.8rem;">Ø­Ø¸Ø±</button>
                </div>
            `;
        }

        function filterStudents(query) {
            const div = document.getElementById('students-list');
            div.innerHTML = '';
            allStudents.forEach(u => {
                if(u.name.includes(query) || u.phone.includes(query)) {
                    renderStudentCard(u, div);
                }
            });
        }

        function setUserStatus(key, status) {
            db.ref('users/' + key).update({ status: status });
        }
        function deleteUser(key) {
            if(confirm('Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ')) db.ref('users/' + key).remove();
        }

        // --- 3. Add Content ---
        function toggleFields() {
            const type = document.getElementById('c-type').value;
            document.getElementById('c-img').style.display = type === 'lecture' ? 'block' : 'none';
        }

        function addContent() {
            const data = {
                type: document.getElementById('c-type').value,
                title: document.getElementById('c-title').value,
                link: document.getElementById('c-link').value,
                image: document.getElementById('c-img').value,
                file: document.getElementById('c-file').value,
                date: new Date().toISOString()
            };
            if(!data.title || !data.link) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            db.ref('lectures').push(data);
            alert('ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­');
            document.getElementById('c-title').value = '';
        }

        // --- 4. Manage Content ---
        db.ref('lectures').on('value', (snap) => {
            const div = document.getElementById('content-list');
            div.innerHTML = '';
            const lecs = snap.val();
            for(let key in lecs) {
                let l = lecs[key];
                div.innerHTML += `
                    <div class="data-card">
                        <h3>${l.title} (${l.type})</h3>
                        <a href="${l.link}" target="_blank" style="color:var(--gold);">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­ØªÙˆÙ‰</a>
                        <button class="btn btn-red" onclick="db.ref('lectures/${key}').remove()">Ø­Ø°Ù</button>
                    </div>
                `;
            }
        });

        // --- 5. Notifications ---
        document.getElementById('n-target').onchange = (e) => {
            document.getElementById('n-email').style.display = e.target.value === 'specific' ? 'block' : 'none';
        };
        function sendNotify() {
            alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ (Ù…Ø­Ø§ÙƒØ§Ø©)');
            // ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡Ø§ Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        }

        // --- 6. Support Tickets ---
        db.ref('tickets').on('value', (snap) => {
            const div = document.getElementById('tickets-list');
            div.innerHTML = '';
            let openCount = 0;
            const tickets = snap.val();
            
            for(let key in tickets) {
                let t = tickets[key];
                if(t.status === 'open') openCount++;
                
                div.innerHTML += `
                    <div class="data-card" style="border-right: 5px solid ${t.status==='open'?'orange':'green'};">
                        <div style="display:flex; justify-content:space-between;">
                            <h4>${t.userName}</h4>
                            <small>${t.date}</small>
                        </div>
                        <p style="background:#0a192f; padding:10px; margin:10px 0;">${t.msg}</p>
                        
                        ${t.status === 'open' ? `
                            <div style="display:flex; gap:10px;">
                                <input type="text" id="rep-${key}" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯ Ù‡Ù†Ø§..." style="margin:0;">
                                <button class="btn btn-green" onclick="replyTicket('${key}')">Ø±Ø¯ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
                            </div>
                        ` : `<p style="color:var(--gold);">ØªÙ… Ø§Ù„Ø±Ø¯: ${t.reply}</p>`}
                    </div>
                `;
            }
            updateBadge('b-sup', openCount);
        });

        function replyTicket(key) {
            const reply = document.getElementById('rep-'+key).value;
            if(!reply) return;
            db.ref('tickets/' + key).update({
                reply: reply,
                status: 'closed'
            });
        }

        function updateBadge(id, count) {
            const b = document.getElementById(id);
            b.innerText = count;
            b.style.display = count > 0 ? 'inline-block' : 'none';
        }

        window.onload = toggleFields;
    </script>
</body>
</html>
